<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <mapper namespace="com.vvote.mapper.UserMapper">
 	
 	<select id="list" resultType="_UserModel">
		select a.noNum, a.imgurl, a.initiator, a.title, a.videourl, a.likes,
		ifnull(b.counting,'0') as mylikes 
		from video_likes_view a
		left join 
		(
			select noNum, count(openid) as counting 
			from vote_list 
			where is_valid='1' and openid=#{openid} 
			group by noNum 
		) b
		on a.noNum=b.noNum
		order by a.likes desc
 	</select>
 	
 	<select id="voteCounts" resultType="Integer">
 		select count(1) as counting from vote_list where openid=#{openid} 
 	</select>
 	
 	<select id="voteCountsToday" resultType="Integer">
 		select count(1) from vote_list where instr(record_time, current_date())>0 and openid=#{openid}
 	</select>
 	
 	<update id="vote">
 		insert into vote_list
 		(openid,noNum,record_time)
 		values
 		(#{openid},#{noNum},sysdate())
 	</update>
 	
 	
 </mapper>